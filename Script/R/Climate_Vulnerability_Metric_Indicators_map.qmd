---
title: "Visualizing Non-Overlapping Disadvantaged Census Tracts: Bolstering CalEnviroScreen Considerations"
author: "Sofia Ingersoll"
format:
  html:
    code-fold: true
    code-summary: "View the code"
embedded-sources: true
output:
  html_document:
    print_df: paged
    toc: yes
    toc_depth: 4
    toc_float: yes
---

```{r set-up, message = FALSE}
library(sf)
#library(sp)
library(tmap)
library(here)
library(stars)
library(terra)
library(raster)
library(maptiles)
library(tidyverse)
library(leaflet)
#library(sfheaders)
#library(ggspatial)
library(tmaptools)
library(osmextract) 
library(RColorBrewer)
```


# Read CalEnviroScreen Data
```{r read_n_wrangle_calenviro}
calenviro <- st_read(here("data","CalEnviroScreen","CES4 Final Shapefile.shp")) %>% 
  janitor::clean_names() %>% 
  st_make_valid()

# housing burden is a good parameter to visualize
# let's get an idea of the bin distribution for plotting
range(calenviro$hous_burd)

# remove the -999.0, that's an NA
calenviro <- calenviro %>% 
  filter(hous_burd != -999.0)

# check! nice!
range(calenviro$hous_burd)

calenviro <- st_transform(calenviro,
                          4326) %>% 
  st_make_valid()
```


```{r read_n_wrangle_SB535}
# sb535 xlsx sheet
# inspecting the tribal data provided on tab 3, there is no geolocation information
# so unfortunately these can't be plotted 

# Define the path to your Excel file
sb535_path <- here("data", "SB535_disadv_communities", "SB535DACresultsdatadictionary_F_2022.xlsx")

# Get the names of all sheets in the Excel file
sheet_names <- readxl::excel_sheets(sb535_path)

# Print sheet names to verify and select the correct one
print(sheet_names)

# Read the fourth sheet directly by its name or index
sb535_tract_data <- readxl::read_xlsx(sb535_path, sheet = sheet_names[4]) %>% 
  janitor::clean_names() %>%
  as.data.frame()

# housing burden is a good parameter to visualize
# let's get an idea of the bin distribution for plotting
range(sb535_tract_data$housing_burden)

# remove the -999.0, that's an NA
sb535_tract_data <- sb535_tract_data %>% 
  
  mutate(housing_burden = as.numeric(housing_burden)) %>% 
  
  filter(!is.na(housing_burden))

# check! nice!
range(sb535_tract_data$housing_burden)

sb535_geo <- sb535_tract_data %>% 
  
  filter(!is.na(longitude) & !is.na(latitude)) %>% 
  
  st_as_sf(coords = c('longitude', "latitude"),
                      crs = 4326) %>% 
  st_make_valid()
```